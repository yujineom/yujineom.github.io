---
layout: post
title:  "slf4j + log4j2 ì ìš©ê¸°(maven)"
date:   2020-05-01
author: yujin eom
categories:  spring
---
<br/><br/>

ë³¸ ë‚´ìš©ì€ slf4jì™€ log4jì— ëŒ€í•œ ìƒì„¸í•œ ì„¤ëª…ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
<br/><br/><br/>


slf4j + log4j ì¡°í•©ì¸ ìƒíƒœì—ì„œ, log4j2ë¡œ ì—…ë°ì´íŠ¸ë¥¼ í•˜ê²Œ ë˜ì—ˆë‹¤. ê´€ë ¨ëœ ë‚´ìš©ì€ êµ¬ê¸€ë§í•˜ë©´ ë‹¤ì–‘í•˜ê²Œ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì—, êµ³ì´ slf4jê°€ ë¬´ì—‡ì¸ì§€ log4jê°€ ë¬´ì—‡ì¸ì§€ëŠ” ë”°ë¡œ êµ¬ìˆ í•˜ì§€ ì•ŠëŠ” ê²ƒìœ¼ë¡œ...!
<br/><br/><br/>


pom.xmlì— ì•„ë˜ì˜ dependencyë¥¼ ì¶”ê°€í•´ì¤€ë‹¤. (mavenì´ ì•„ë‹Œ Gradleì´ë‚˜ ê¸°íƒ€ ì´ì™¸ì˜ buildì¸ ê²½ìš° [ì°¸ê³ ë§í¬][log4j2-maven]{:target="_blank"}ë¥¼ í†µí•´ í™•ì¸í•˜ì—¬ ì•Œë§ê²Œ ì ìš©)
<br/>
```xml
<dependencies>
  <dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-api</artifactId>
    <version>2.13.1</version>
  </dependency>
  <dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.13.1</version>
  </dependency>
</dependencies>
```
<br/><br/><br/>


### Log4j 1.x API Bridge
<br/>
Log4j 1.xì˜ ì»´í¬ë„ŒíŠ¸ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° Log4j2ë¡œ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë„ë¡ Log4j 1.x API Bridgeë¥¼ ì¶”ê°€í•´ì¤€ë‹¤
<br/>
```xml
<dependencies>
  <dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-1.2-api</artifactId>
    <version>2.13.1</version>
  </dependency>
</dependencies>
```
<br/><br/><br/>


### SLF4j Bridge
<br/>
SLF4Jë¥¼ í†µí•´ log4jë¥¼ ì²˜ë¦¬í•˜ê³  ìˆìœ¼ë¯€ë¡œ ê´€ë ¨í•œ dependencyë„ ì¶”ê°€í•´ì¤€ë‹¤.<br/>

ë§Œì•½ ê¸°ì¡´ slf4j + log4j ì¡°í•©ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤ë©´ `slf4j-log4j12` dependencyê°€ ì¡´ì¬í• í…ë°, í•´ë‹¹ dependencyëŠ” ì‚­ì œí•˜ê³   `log4j-slf4j-impl` ë¥¼ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.<br/>

```xml
<dependencies>
  <dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-slf4j-impl</artifactId>
    <version>2.13.1</version>
  </dependency>
</dependencies>
```
<br/><br/><br/>


### ê·¸ ì™¸ ê¸°íƒ€ ì„¤ì •
<br/>
log4jì™€ log4j2ëŠ” setting xmlì˜ ë¬¸ë²•ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ë‚´ìš©ë„ ë³€ê²½ì„ í•´ì¤˜ì•¼í•œë‹¤.<br/>

ë˜í•œ, í˜¹ì‹œë¼ë„ ì†ŒìŠ¤ ë‚´ì—ì„œ log4jë¡œ ì§ì ‘ì  loggingì„ í•˜ê³  ìˆë‹¤ë©´ slf4jë¡œ ìˆ˜ì •í•´ì£¼ëŠ” ê²ƒë„ ìŠì§€ë§ê²ƒ! (í•´ë‹¹ ë‚´ìš©ì€ lombokì˜ @Slf4j ë¡œ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•´ì£¼ì—ˆë‹¤)
<br/><br/><br/>


ìˆœì¡°ë¡­ê²Œ ì§„í–‰í•˜ê³  ì´ì œ í”„ë¡œì íŠ¸ë¥¼ ë„ì–´ë³´ì.<br/><br/><br/><br/>





## ì²«ë²ˆì§¸ ìœ„ê¸°ìƒí™©

<br/>
```
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/###/WEB-INF/lib/log4j-slf4j-impl-2.13.0.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/###/WEB-INF/lib/slf4j-log4j12-1.6.4.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]
```

ìœ„ì™€ ê°™ì€ multiple SLF4J bindings warningì„ ë°œê²¬í–ˆë‹¤. SLF4jëŠ” í•˜ë‚˜ì˜ logging frameworkì™€ bindë¥¼ í•˜ëŠ”ë°, ì—¬ëŸ¬ê°œì˜ bindingì´ ì¡´ì¬í•œë‹¤ëŠ” ê²½ê³ ì´ë‹¤. <br/><br/><br/>



ë¶„ëª…íˆ slf4j-log4j12 dependencyë¥¼ ì‚­ì œí–ˆëŠ”ë° ì™œ ì´ëŸ° ê²½ê³ ê°€ ë‚˜ëŠ”ê±¸ê¹Œ?<br/>

maven clean í›„ ì§„í–‰í•´ë„ ë§ˆì°¬ê°€ì§€... ê·¸ë ‡ë‹¤ë©´ ë‹¤ë¥¸ dependencyì— ë‚´ë¶€ì ìœ¼ë¡œ slf4j-log4j12ê°€ ìˆëŠ”ê²ƒì€ ì•„ë‹ê¹Œ?<br/><br/><br/>



```
mvn dependency:tree
```

dependency:treeë¥¼ í†µí•´ í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ dependency êµ¬ì¡°ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.<br/><br/><br/>



```
[INFO] +- org.docx4j:docx4j:jar:3.3.5:compile 
[INFO] |  +- org.slf4j:slf4j-log4j12:jar:1.7.21:compile 
[INFO] |  +- log4j:log4j:jar:1.2.17:compile 
[INFO] +- ch.qos.logback:logback-classic:jar:1.1.7:compile 
[INFO] +- ch.qos.logback:logback-core:jar:1.1.7:compile
```

ìœ„ì˜ ì˜ˆì‹œì—ì„œëŠ” org.docx4jì—ì„œ slf4j-log4j12ë¥¼ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤.  (ë‚˜ëŠ” íšŒì‚¬ì™€ ê´€ë ¨ëœ dependencyì—ì„œ ë°œê²¬ì´ ë˜ì–´ì„œ [ì°¸ê³ ë§í¬][log4j2-example]{:target="_blank"}ì— ìˆëŠ” ì˜ˆì‹œë¡œ ëŒ€ì²´!)<br/><br/>



```xml
<dependency>
    <groupId>org.docx4j</groupId>
    <artifactId>docx4j</artifactId>
    <version>${docx4j.version}</version>
    <exclusions>
        <exclusion>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-log4j12</artifactId>
        </exclusion>
        <exclusion>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
        </exclusion>
    </exclusions>
</dependency>
```

ë°œê²¬ëœ dependencyì—ì„œ slf4j-log4j12ë¥¼ ì œì™¸í•´ì¤€ë‹¤. <br/><br/><br/>



ì´ì œ ë‹¤ì‹œ ì‹¤í–‰í•´ë³´ë©´, ë³´ê¸°ì‹«ë˜ ë¹¨ê°„ìƒ‰ ê²½ê³ ê°€ ì‚¬ë¼ì¡Œë‹¤! localì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ë§ˆì¹œ í›„ devì— ì ìš©ì„ í•˜ì˜€ë‹¤.<br/><br/><br/><br/><br/>





## ë‘ ë²ˆì§¸ ìœ„ê¸°ìƒí™©

ê°œë°œì— ë°°í¬í•˜ì—¬ í…ŒìŠ¤íŠ¸ í›„ í° ì´ìŠˆê°€ ì—†ìœ¼ë©´ master mergeë¥¼ í•˜ë ¤ê³  í–ˆëŠ”ë°, ê°œë°œ ë¡œê·¸ë¥¼ ë³´ë˜ ì¤‘ log4j2 ì ìš©ìœ¼ë¡œ ì¸í•´ ë°œìƒí•œë“¯í•œ errorë¥¼ ë°œê²¬í•˜ì˜€ë‹¤....(ëª¨ë¥¸ì²™)ğŸ˜<br/><br/><br/>



redis ì—ëŸ¬ì´ë©° ë¡œê·¸ì˜ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ë‹¤.

```
org.springframework.data.redis.serializer.SerializationException: Cannot deserialize; nested exception is org.springframework.core.serializer.support.SerializationFailedException: Failed to deserialize payload. Is the byte array a result of corresponding serialization for DefaultDeserializer?; nested exception is org.springframework.core.NestedIOException: Failed to deserialize object type; nested exception is java.lang.ClassNotFoundException: org.slf4j.impl.Log4jLoggerAdapter
```

Log4jLoggerAdapterë¥¼ ì°¾ì„ ìˆ˜ ì—†ë‹¤ëŠ” ë‚´ìš©ì¸ë°, Log4jLoggerAdapterëŠ” slf4j-log4j12ì— ì†í•œ í´ë˜ìŠ¤ì´ê¸° ë•Œë¬¸ì— ë˜ í•œ ë²ˆ ë‹¹í™©í–ˆë‹¤.... <br/>

![post5-image01](/assets/post_image/post5-image01.png)


<br/><br/>
ì–´ë”˜ê°€ì— ë˜ slf4j-log4j12ì˜ í”ì ì´ ë‚¨ì•„ìˆëŠ” ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ì•„ë¬´ë¦¬ ì°¾ì•„ë„ ì†ŒìŠ¤ ìƒì— Log4jLoggerAdapterëŠ” ì°¾ì„ ìˆ˜ ì—†ì—ˆë‹¤. ê°„í—ì ìœ¼ë¡œ ë°œìƒë˜ëŠ” ì˜¤ë¥˜ ë•Œë¬¸ì— ì¬í˜„ë„ ì‰½ì§€ ì•Šì•˜ê³  ë‹¨ì„œëŠ” ê·¸ì € redis error<br/>

ê·¸ëŸ¬ë˜ ì¤‘ redisë¡œ ì €ì¥í•˜ê³  ìˆëŠ” class ì¤‘ ë‚´ë¶€ì ìœ¼ë¡œ logë¥¼ ì°ê³  ìˆëŠ” í´ë˜ìŠ¤ë¥¼ ë°œê²¬í•˜ì˜€ë‹¤. ê·¸ë¦¬ê³  í•´ë‹¹ classê°€ serialize ë˜ì–´ ì €ì¥ëœ ê°’ì„ ë³´ì•˜ë‹¤. ê±°ê¸°ì„œ Log4jLoggerAdapterë¥¼ ë°œê²¬í•˜ì˜€ë‹¤!<br/><br/><br/>



ê°œë°œí™˜ê²½ì—ëŠ” log4j2 ì—…ë°ì´íŠ¸ ì „ Log4jLoggerAdapaterë¡œ serialize ëœ í´ë˜ìŠ¤ê°€ redisì— ë‚¨ì•„ìˆì—ˆë‹¤. (ê°œë°œ ë°°í¬ í›„ redis clear í•˜ì§€ ì•Šì€ ìƒíƒœ)<br/>

ë”°ë¼ì„œ redisì—ì„œ ê´€ë ¨ í´ë˜ìŠ¤ë¥¼ deserialize í•˜ì˜€ì§€ë§Œ, log4j2ë¡œ ì—…ë°ì´íŠ¸ë˜ë©° Log4jLoggerAdapterê°€ ì‚­ì œë˜ì—ˆìœ¼ë¯€ë¡œ ClassNotFoundExceptionì´ ë°œìƒí•œ ê²ƒì´ì—ˆë‹¤.<br/><br/><br/>



ê·¸ì € redis clear í–ˆìœ¼ë©´ ë ì¼.......<br/><br/><br/>



master ë°°í¬ ì‹œì—ëŠ” ê´€ë ¨ í´ë˜ìŠ¤ì— ëŒ€í•˜ì—¬ redisì—ì„œ ì‚­ì œ í›„ ì§„í–‰í•˜ë‹ˆ ì•„ë¬´ëŸ° ì´ìŠˆê°€ ì—†ì—ˆìŠµë‹ˆë‹¤.<br/>

ì´ë ‡ê²Œ ê°„ë‹¨í•œ ë‚´ìš©ì„ 2ì£¼ë™ì•ˆì´ë‚˜ ì•¼ê¸ˆì•¼ê¸ˆ ì‚½ì§ˆí–ˆë‹¤ëŠ” ìŠ¬í”ˆ ì´ì•¼ê¸°.



### ì°¸ê³ ë§í¬

* http://logging.apache.org/log4j/2.x/index.html
* http://logging.apache.org/log4j/2.x/maven-artifacts.html 
* https://www.baeldung.com/slf4j-classpath-multiple-bindings
* http://www.slf4j.org/api/org/slf4j/impl/Log4jLoggerAdapter.html

[log4j2-docs]: http://logging.apache.org/log4j/2.x/index.html
[log4j2-maven]: http://logging.apache.org/log4j/2.x/maven-artifacts.html 
[log4j2-example]: https://www.baeldung.com/slf4j-classpath-multiple-bindings
[slf4j-log4j2]: http://www.slf4j.org/api/org/slf4j/impl/Log4jLoggerAdapter.html